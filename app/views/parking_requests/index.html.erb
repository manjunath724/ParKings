<h1>Parking Requests</h1>

<div class="table-responsive-sm">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Car</th>
        <th>Status</th>
        <th>Slot</th>
        <th>Entry on</th>
        <th>Exit on</th>
        <th>Total time</th>
        <th>Amount</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <% @parking_requests.each do |request| %>
        <tr>
          <td><%= request.car.identity %></td>
          <td><%= request.status %></td>
          <td><%= request.slot.specifics rescue nil %></td>
          <td><%= request.entry_on.strftime("%d/%m/%Y - %I:%M %p") rescue nil %></td>
          <td><%= request.exit_on.strftime("%d/%m/%Y - %I:%M %p") rescue nil %></td>
          <td><%= request.total_time %></td>
          <td><%= request.amount %></td>
          <td>
            <%= link_to 'Allot Slot', edit_parking_request_path(request), class: 'btn btn-sm btn-info' if current_user.admin? && request.requested? %>
            <%= link_to 'Release Slot', release_parking_request_path(request), method: :post, class: 'btn btn-sm btn-primary' if current_user.user? && request.allotted? %>
            <%= link_to 'Discharge Slot', discharge_parking_request_path(request), method: :post, class: 'btn btn-sm btn-success' if current_user.admin? && request.release? %>
            <%= link_to 'Cancel', request, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger' if current_user.user? && request.requested? %>
            <%= link_to '<span class="glyphicon glyphicon-ok-circle"></span>'.html_safe if request.discharged? %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
